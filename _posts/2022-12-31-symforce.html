---
layout: notebook
title: Symforce
description: Symforce basics
tag: Notebook
---

<div class="cell border-box-sizing text_cell rendered">
 <div class="prompt input_prompt">
 </div>
 <div class="inner_cell">
  <div class="text_cell_render border-box-sizing rendered_html">
  </div>
 </div>
</div>
<div class="cell border-box-sizing text_cell rendered">
 <div class="prompt input_prompt">
 </div>
 <div class="inner_cell">
  <div class="text_cell_render border-box-sizing rendered_html">
   <h2 id="Introduction">
    Introduction
    <a class="anchor-link" href="#Introduction">
     ¶
    </a>
   </h2>
  </div>
 </div>
</div>
<div class="cell border-box-sizing text_cell rendered">
 <div class="prompt input_prompt">
 </div>
 <div class="inner_cell">
  <div class="text_cell_render border-box-sizing rendered_html">
   <p>
    <a href="https://symforce.org/">
     SymForce
    </a>
    is a fast symbolic computation and code generation library for robotics applications like computer vision, state estimation, motion planning, and controls. It combines the development speed and flexibility of symbolic mathematics with the performance of autogenerated, highly optimized code in C++ or any target runtime language. SymForce contains three independently useful systems:
   </p>
   <p>
    <strong>
     Symbolic Toolkit
    </strong>
    - builds on the SymPy API to provide rigorous geometric and camera types, lie group calculus, singularity handling, and tools to model complex problems
   </p>
   <p>
    <strong>
     Code Generator
    </strong>
    - transforms symbolic expressions into blazing-fast, branchless code with clean APIs and minimal dependencies, with a template system to target any language
   </p>
   <p>
    <strong>
     Optimization Library
    </strong>
    - a fast tangent-space optimization library based on factor graphs, with a highly optimized implementation for real-time robotics applications
   </p>
   <p>
    SymForce automatically computes tangent space Jacobians, eliminating the need for any bug-prone handwritten derivatives. Generated functions can be directly used as factors in our nonlinear optimizer. This workflow enables faster runtime functions, faster development time, and fewer lines of handwritten code versus alternative methods.
   </p>
   <p>
    SymForce is developed and maintained by
    <strong>
     Skydio
    </strong>
    . It is used in production to accelerate tasks like SLAM, bundle adjustment, calibration, and sparse nonlinear MPC for autonomous robots at scale.
   </p>
  </div>
 </div>
</div>
<div class="cell border-box-sizing text_cell rendered">
 <div class="prompt input_prompt">
 </div>
 <div class="inner_cell">
  <div class="text_cell_render border-box-sizing rendered_html">
   <h2 id="Tutorials">
    Tutorials
    <a class="anchor-link" href="#Tutorials">
     ¶
    </a>
   </h2>
  </div>
 </div>
</div>
<div class="cell border-box-sizing code_cell rendered">
 <div class="input">
  <div class="prompt input_prompt">
   In [1]:
  </div>
  <div class="inner_cell">
   <div class="input_area collapsed">
    <div class="collapse_expand_button fa fa-1x fa-minus-square-o">
    </div>
    <div class="highlight hl-ipython3">
     <pre><span></span><span class="c1"># Import symforce</span>
<span class="kn">import</span> <span class="nn">symforce</span>

<span class="n">symforce</span><span class="o">.</span><span class="n">set_symbolic_api</span><span class="p">(</span><span class="s2">"sympy"</span><span class="p">)</span>
<span class="n">symforce</span><span class="o">.</span><span class="n">set_log_level</span><span class="p">(</span><span class="s2">"warning"</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">symforce.symbolic</span> <span class="k">as</span> <span class="nn">sf</span>
<span class="c1">#</span>
</pre>
    </div>
   </div>
  </div>
 </div>
</div>
<div class="cell border-box-sizing text_cell rendered">
 <div class="prompt input_prompt">
 </div>
 <div class="inner_cell">
  <div class="text_cell_render border-box-sizing rendered_html">
   <h3 id="Geo-Package">
    Geo Package
    <a class="anchor-link" href="#Geo-Package">
     ¶
    </a>
   </h3>
  </div>
 </div>
</div>
<div class="cell border-box-sizing text_cell rendered">
 <div class="prompt input_prompt">
 </div>
 <div class="inner_cell">
  <div class="text_cell_render border-box-sizing rendered_html">
   <h4 id="Matrix">
    Matrix
    <a class="anchor-link" href="#Matrix">
     ¶
    </a>
   </h4>
  </div>
 </div>
</div>
<div class="cell border-box-sizing code_cell rendered">
 <div class="input">
  <div class="prompt input_prompt">
   In [ ]:
  </div>
  <div class="inner_cell">
   <div class="input_area collapsed">
    <div class="collapse_expand_button fa fa-1x fa-minus-square-o">
    </div>
    <div class="highlight hl-ipython3">
     <pre><span></span><span class="c1"># Define matrix</span>
<span class="kn">import</span> <span class="nn">symforce.symbolic</span> <span class="k">as</span> <span class="nn">sf</span>
<span class="kn">from</span> <span class="nn">symforce.notebook_util</span> <span class="kn">import</span> <span class="n">display</span>

<span class="c1"># Construction from 2D list</span>
<span class="n">m1</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">Matrix</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">m1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># Construction using specified size + data</span>
<span class="n">m2</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">Matrix</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">m2</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># Construction from 2D list</span>
<span class="n">v1</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">Matrix</span><span class="p">([[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">]])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">v1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># Construction from 1D list. We assume a 1D list represents a column vector.</span>
<span class="n">v2</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">Matrix</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">v2</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># Construction using aliases (defined by default for 9x1 vectors and smaller)</span>
<span class="n">v3</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">V3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">v3</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="n">zero_matrix</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">Matrix33</span><span class="o">.</span><span class="n">zero</span><span class="p">()</span>
<span class="n">identity_matrix</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">Matrix33</span><span class="o">.</span><span class="n">eye</span><span class="p">()</span>

<span class="n">zero_matrix</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">Matrix</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">identity_matrix</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">Matrix</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="c1">#</span>
</pre>
    </div>
   </div>
  </div>
 </div>
</div>
<div class="cell border-box-sizing text_cell rendered">
 <div class="prompt input_prompt">
 </div>
 <div class="inner_cell">
  <div class="text_cell_render border-box-sizing rendered_html">
   <h4 id="Rotations">
    Rotations
    <a class="anchor-link" href="#Rotations">
     ¶
    </a>
   </h4>
   <p>
    Quaternion is used as the underlying representation.
   </p>
  </div>
 </div>
</div>
<div class="cell border-box-sizing code_cell rendered">
 <div class="input">
  <div class="prompt input_prompt">
   In [4]:
  </div>
  <div class="inner_cell">
   <div class="input_area collapsed">
    <div class="collapse_expand_button fa fa-1x fa-minus-square-o">
    </div>
    <div class="highlight hl-ipython3">
     <pre><span></span><span class="c1"># Define rotations</span>

<span class="kn">import</span> <span class="nn">symforce.symbolic</span> <span class="k">as</span> <span class="nn">sf</span>
<span class="kn">from</span> <span class="nn">symforce.notebook_util</span> <span class="kn">import</span> <span class="n">display</span>

<span class="c1"># Identity definition</span>
<span class="n">R</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">Rot3</span><span class="p">()</span>
<span class="n">display</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">to_rotation_matrix</span><span class="p">())</span>
<span class="n">display</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">to_rotation_matrix</span><span class="p">()</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>

<span class="c1"># Symbolic definition</span>
<span class="n">R_sym</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">Rot3</span><span class="o">.</span><span class="n">symbolic</span><span class="p">(</span><span class="s2">"R"</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">R_sym</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">R_sym</span><span class="o">.</span><span class="n">to_rotation_matrix</span><span class="p">())</span>

<span class="c1"># Symbolic definition</span>
<span class="n">Q_sym</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">Quaternion</span><span class="o">.</span><span class="n">symbolic</span><span class="p">(</span><span class="s2">"Q"</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">Q_sym</span><span class="p">)</span>
<span class="c1">#</span>
</pre>
    </div>
   </div>
  </div>
 </div>
 <div class="output_wrapper">
  <div class="output">
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_text output_subarea">
     <pre>&lt;Rot3 &lt;Q xyzw=[0, 0, 0, 1]&gt;&gt;</pre>
    </div>
   </div>
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_latex output_subarea">
     $\displaystyle \left[\begin{matrix}1 &amp; 0 &amp; 0\\0 &amp; 1 &amp; 0\\0 &amp; 0 &amp; 1\end{matrix}\right]$
    </div>
   </div>
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_text output_subarea">
     <pre>array([[1., 0., 0.],
       [0., 1., 0.],
       [0., 0., 1.]])</pre>
    </div>
   </div>
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_text output_subarea">
     <pre>&lt;Rot3 &lt;Q xyzw=[R_x, R_y, R_z, R_w]&gt;&gt;</pre>
    </div>
   </div>
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_latex output_subarea">
     $\displaystyle \left[\begin{matrix}- 2 R_{y}^{2} - 2 R_{z}^{2} + 1 &amp; - 2 R_{w} R_{z} + 2 R_{x} R_{y} &amp; 2 R_{w} R_{y} + 2 R_{x} R_{z}\\2 R_{w} R_{z} + 2 R_{x} R_{y} &amp; - 2 R_{x}^{2} - 2 R_{z}^{2} + 1 &amp; - 2 R_{w} R_{x} + 2 R_{y} R_{z}\\- 2 R_{w} R_{y} + 2 R_{x} R_{z} &amp; 2 R_{w} R_{x} + 2 R_{y} R_{z} &amp; - 2 R_{x}^{2} - 2 R_{y}^{2} + 1\end{matrix}\right]$
    </div>
   </div>
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_text output_subarea">
     <pre>&lt;Q xyzw=[Q_x, Q_y, Q_z, Q_w]&gt;</pre>
    </div>
   </div>
  </div>
 </div>
</div>
<div class="cell border-box-sizing text_cell rendered">
 <div class="prompt input_prompt">
 </div>
 <div class="inner_cell">
  <div class="text_cell_render border-box-sizing rendered_html">
   <h4 id="symforce.symbolic.Pose3-and--sym.Pose3">
    symforce.symbolic.Pose3 and  sym.Pose3
    <a class="anchor-link" href="#symforce.symbolic.Pose3-and--sym.Pose3">
     ¶
    </a>
   </h4>
   <p>
    SymForce provides
    <strong>
     sym
    </strong>
    packages with
    <strong>
     runtime code
    </strong>
    for geometry and camera types, e.g.
    <code>
     sym.Pose3
    </code>
    that are generated from its
    <strong>
     symbolic geo and cam packages
    </strong>
    , e.g.
    <code>
     symforce.symbolic.Pose3
    </code>
    . As such, there are multiple versions of a class like Pose3 and it can be a common source of confusion.
   </p>
  </div>
 </div>
</div>
<div class="cell border-box-sizing code_cell rendered">
 <div class="input">
  <div class="prompt input_prompt">
   In [2]:
  </div>
  <div class="inner_cell">
   <div class="input_area collapsed">
    <div class="collapse_expand_button fa fa-1x fa-minus-square-o">
    </div>
    <div class="highlight hl-ipython3">
     <pre><span></span><span class="c1"># symforce.symbolic</span>
<span class="kn">import</span> <span class="nn">symforce.symbolic</span> <span class="k">as</span> <span class="nn">sf</span>
<span class="kn">from</span> <span class="nn">symforce.notebook_util</span> <span class="kn">import</span> <span class="n">display</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">Quaternion</span><span class="p">(</span><span class="n">xyz</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">V3</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="n">w</span><span class="o">=</span><span class="n">sf</span><span class="o">.</span><span class="n">Scalar</span><span class="p">(</span><span class="mf">1.0</span><span class="p">))</span>
<span class="n">R</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">Rot3</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">V3</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<span class="n">T</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">Pose3</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
<span class="c1">#</span>
</pre>
    </div>
   </div>
  </div>
 </div>
 <div class="output_wrapper">
  <div class="output">
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_text output_subarea">
     <pre>&lt;Pose3 R=&lt;Rot3 &lt;Q xyzw=[0, 0, 0, 1.0]&gt;&gt;, t=(0, 0, 0)&gt;</pre>
    </div>
   </div>
  </div>
 </div>
</div>
<div class="cell border-box-sizing code_cell rendered">
 <div class="input">
  <div class="prompt input_prompt">
   In [119]:
  </div>
  <div class="inner_cell">
   <div class="input_area">
    <div class="collapse_expand_button fa fa-1x fa-minus-square-o">
    </div>
    <div class="highlight hl-ipython3">
     <pre><span></span><span class="c1"># sym runtime code</span>
<span class="kn">import</span> <span class="nn">sym</span>
<span class="kn">import</span> <span class="nn">symforce.symbolic</span> <span class="k">as</span> <span class="nn">sf</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"sym package rotation matrix type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">sym</span><span class="o">.</span><span class="n">Pose3</span><span class="o">.</span><span class="n">identity</span><span class="p">()</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">to_rotation_matrix</span><span class="p">())</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"symbolic package rotation matrix type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">sf</span><span class="o">.</span><span class="n">Pose3</span><span class="o">.</span><span class="n">identity</span><span class="p">()</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">to_rotation_matrix</span><span class="p">())</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"symbolic package rotation matrix to_numpy type: </span><span class="si">{</span> <span class="nb">type</span><span class="p">(</span><span class="n">sf</span><span class="o">.</span><span class="n">Pose3</span><span class="o">.</span><span class="n">identity</span><span class="p">()</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">to_rotation_matrix</span><span class="p">()</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre>
    </div>
   </div>
  </div>
 </div>
 <div class="output_wrapper">
  <div class="output">
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_subarea output_stream output_stdout output_text">
     <pre>sym package rotation matrix type: &lt;class 'numpy.ndarray'&gt;
symbolic package rotation matrix type: &lt;class 'symforce.geo.matrix.Matrix33'&gt;
symbolic package rotation matrix to_numpy type: &lt;class 'numpy.ndarray'&gt;
</pre>
    </div>
   </div>
  </div>
 </div>
</div>
<div class="cell border-box-sizing code_cell rendered">
 <div class="input">
  <div class="prompt input_prompt">
   In [ ]:
  </div>
  <div class="inner_cell">
   <div class="input_area collapsed">
    <div class="collapse_expand_button fa fa-1x fa-minus-square-o">
    </div>
    <div class="highlight hl-ipython3">
     <pre><span></span><span class="c1"># k3d plot helper</span>

<span class="kn">import</span> <span class="nn">k3d</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="c1"># TODO(xipeng.wang): Update this to use symforce directly instead of numpy</span>
<span class="k">class</span> <span class="nc">XYZ_RBG_Axes</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plot</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="mh">0xffff00</span><span class="p">,</span> <span class="n">axis_length</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis_length</span> <span class="o">=</span> <span class="n">axis_length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span> <span class="o">=</span> <span class="n">plot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">=</span> <span class="n">R</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">origin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span>
        <span class="n">x_axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">origin</span><span class="p">,</span> <span class="n">origin</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">axis_length</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">y_axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">origin</span><span class="p">,</span> <span class="n">origin</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="n">axis_length</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">z_axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">origin</span><span class="p">,</span> <span class="n">origin</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">axis_length</span><span class="p">]))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xline_plot</span> <span class="o">=</span> <span class="n">k3d</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">x_axis</span><span class="p">,</span> <span class="n">shader</span><span class="o">=</span><span class="s1">'mesh'</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="mh">0xff0000</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="o">+</span><span class="s1">'_xaxis'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yline_plot</span> <span class="o">=</span> <span class="n">k3d</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">y_axis</span><span class="p">,</span> <span class="n">shader</span><span class="o">=</span><span class="s1">'mesh'</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="mh">0x0000ff</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="o">+</span><span class="s1">'_yaxis'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zline_plot</span> <span class="o">=</span> <span class="n">k3d</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">z_axis</span><span class="p">,</span> <span class="n">shader</span><span class="o">=</span><span class="s1">'mesh'</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="mh">0x00ff00</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="o">+</span><span class="s1">'_zaxis'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xpoint</span> <span class="o">=</span> <span class="n">k3d</span><span class="o">.</span><span class="n">points</span><span class="p">(</span><span class="n">origin</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">axis_length</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">point_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> 
                                  <span class="n">shader</span><span class="o">=</span><span class="s1">'3d'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">'_end_point_x'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ypoint</span> <span class="o">=</span> <span class="n">k3d</span><span class="o">.</span><span class="n">points</span><span class="p">(</span><span class="n">origin</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="n">axis_length</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">point_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> 
                                  <span class="n">shader</span><span class="o">=</span><span class="s1">'3d'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">'_end_point_y'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zpoint</span> <span class="o">=</span> <span class="n">k3d</span><span class="o">.</span><span class="n">points</span><span class="p">(</span><span class="n">origin</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">axis_length</span><span class="p">]))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">point_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> 
                                  <span class="n">shader</span><span class="o">=</span><span class="s1">'3d'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">'_end_point_z'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xline_plot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yline_plot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zline_plot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xpoint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ypoint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zpoint</span> 
    <span class="k">def</span> <span class="nf">update_pose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">=</span> <span class="n">R</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">origin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span>
        <span class="n">axis_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_length</span>
        <span class="n">x_axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">origin</span><span class="p">,</span> <span class="n">origin</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">axis_length</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">y_axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">origin</span><span class="p">,</span> <span class="n">origin</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="n">axis_length</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">z_axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">origin</span><span class="p">,</span> <span class="n">origin</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">axis_length</span><span class="p">]))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xline_plot</span><span class="o">.</span><span class="n">vertices</span> <span class="o">=</span> <span class="n">x_axis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xpoint</span><span class="o">.</span><span class="n">positions</span> <span class="o">=</span> <span class="n">origin</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">axis_length</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yline_plot</span><span class="o">.</span><span class="n">vertices</span> <span class="o">=</span> <span class="n">y_axis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ypoint</span><span class="o">.</span><span class="n">positions</span> <span class="o">=</span> <span class="n">origin</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="n">axis_length</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zline_plot</span><span class="o">.</span><span class="n">vertices</span> <span class="o">=</span> <span class="n">z_axis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zpoint</span><span class="o">.</span><span class="n">positions</span> <span class="o">=</span> <span class="n">origin</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">axis_length</span><span class="p">]))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="c1">#</span>
</pre>
    </div>
   </div>
  </div>
 </div>
</div>
<div class="cell border-box-sizing code_cell rendered">
 <div class="input">
  <div class="prompt input_prompt">
   In [ ]:
  </div>
  <div class="inner_cell">
   <div class="input_area collapsed">
    <div class="collapse_expand_button fa fa-1x fa-minus-square-o">
    </div>
    <div class="highlight hl-ipython3">
     <pre><span></span><span class="c1"># k3d plot example</span>

<span class="n">plot</span> <span class="o">=</span> <span class="n">k3d</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">camera_auto_fit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">R</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">Rot3</span><span class="p">()</span><span class="o">.</span><span class="n">to_rotation_matrix</span><span class="p">()</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">V3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">C0</span> <span class="o">=</span> <span class="n">XYZ_RBG_Axes</span><span class="p">(</span><span class="n">plot</span><span class="p">,</span> <span class="s1">'C0'</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>

<span class="n">R</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">Rot3</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">.</span><span class="n">to_rotation_matrix</span><span class="p">()</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">V3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">C1</span> <span class="o">=</span> <span class="n">XYZ_RBG_Axes</span><span class="p">(</span><span class="n">plot</span><span class="p">,</span> <span class="s1">'C1'</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>

<span class="n">plot</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>

<span class="c1">#</span>
</pre>
    </div>
   </div>
  </div>
 </div>
</div>
<div class="cell border-box-sizing text_cell rendered">
 <div class="prompt input_prompt">
 </div>
 <div class="inner_cell">
  <div class="text_cell_render border-box-sizing rendered_html">
   <h3 id="Values">
    Values
    <a class="anchor-link" href="#Values">
     ¶
    </a>
   </h3>
   <p>
    Values objects are ordered dict-like containers used to store multiple heterogeneous objects, normally for the purpose of function generation.
   </p>
  </div>
 </div>
</div>
<div class="cell border-box-sizing code_cell rendered">
 <div class="input">
  <div class="prompt input_prompt">
   In [106]:
  </div>
  <div class="inner_cell">
   <div class="input_area collapsed">
    <div class="collapse_expand_button fa fa-1x fa-minus-square-o">
    </div>
    <div class="highlight hl-ipython3">
     <pre><span></span><span class="c1"># Create Values</span>

<span class="kn">import</span> <span class="nn">symforce.symbolic</span> <span class="k">as</span> <span class="nn">sf</span>
<span class="kn">from</span> <span class="nn">symforce.values</span> <span class="kn">import</span> <span class="n">Values</span>
<span class="kn">from</span> <span class="nn">symforce.notebook_util</span> <span class="kn">import</span> <span class="n">display</span>

<span class="n">inputs</span> <span class="o">=</span> <span class="n">Values</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">sf</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="s2">"x"</span><span class="p">),</span>
    <span class="n">y</span><span class="o">=</span><span class="n">sf</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="s2">"y"</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">inputs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">sf</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="s2">"z"</span><span class="p">))</span>

<span class="n">time</span> <span class="o">=</span> <span class="n">Values</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">"h"</span><span class="p">:</span> <span class="n">sf</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="s2">"h"</span><span class="p">),</span>
     <span class="s2">"m"</span><span class="p">:</span> <span class="n">sf</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="s2">"m"</span><span class="p">),</span>
     <span class="s2">"s"</span><span class="p">:</span> <span class="n">sf</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="s2">"s"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="n">timezone</span> <span class="o">=</span> <span class="n">Values</span><span class="p">(</span><span class="n">time_zone</span><span class="o">=</span><span class="n">sf</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="s2">"zone"</span><span class="p">))</span>
<span class="c1"># time["t"] =  time</span>
<span class="n">inputs</span><span class="p">[</span><span class="s2">"t"</span><span class="p">]</span> <span class="o">=</span>  <span class="n">time</span>
<span class="n">time</span><span class="p">[</span><span class="s2">"timezone"</span><span class="p">]</span> <span class="o">=</span>  <span class="n">timezone</span>
<span class="n">inputs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">"id"</span><span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>

<span class="c1"># A Values serializes to a depth-first traversed list.</span>
<span class="c1"># display(inputs.to_storage())</span>

<span class="n">display</span><span class="p">(</span><span class="n">inputs</span><span class="o">.</span><span class="n">items_recursive</span><span class="p">())</span>
<span class="c1"># display(inputs.keys_recursive())</span>
<span class="c1"># display(inputs.values_recursive())</span>

<span class="c1"># Index describes which parts of the serialized list correspond to which types. </span>
<span class="c1"># The spec is T.Dict[str, IndexEntry] where IndexEntry has attributes </span>
<span class="c1"># offset, storage_dim, datatype, shape, item_index</span>
<span class="n">index</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">index</span><span class="p">()</span>
<span class="n">reconstructed_inputs</span> <span class="o">=</span> <span class="n">Values</span><span class="o">.</span><span class="n">from_storage_index</span><span class="p">(</span><span class="n">inputs</span><span class="o">.</span><span class="n">to_storage</span><span class="p">(),</span> <span class="n">index</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">inputs</span> <span class="o">==</span> <span class="n">reconstructed_inputs</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Before modifying id: </span><span class="si">{</span><span class="n">inputs</span><span class="p">[</span><span class="s2">"id"</span><span class="p">]</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
<span class="n">inputs</span><span class="p">[</span><span class="s2">"id"</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1024</span>
<span class="n">inputs</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">1024</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'After modifying id: </span><span class="si">{</span><span class="n">inputs</span><span class="p">[</span><span class="s2">"id"</span><span class="p">]</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>

<span class="c1">#</span>
</pre>
    </div>
   </div>
  </div>
 </div>
 <div class="output_wrapper">
  <div class="output">
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_text output_subarea">
     <pre>Values(
  x: x,
  y: y,
  z: z,
  t:   Values(
    h: h,
    m: m,
    s: s,
    timezone:     Values(
      time_zone: zone,
    ),
  ),
  id: id,
)</pre>
    </div>
   </div>
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_text output_subarea">
     <pre>[('x', x),
 ('y', y),
 ('z', z),
 ('t.h', h),
 ('t.m', m),
 ('t.s', s),
 ('t.timezone.time_zone', zone),
 ('id', id)]</pre>
    </div>
   </div>
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_subarea output_stream output_stdout output_text">
     <pre>Before modifying id: id
After modifying id: 1024
</pre>
    </div>
   </div>
  </div>
 </div>
</div>
<div class="cell border-box-sizing code_cell rendered">
 <div class="input">
  <div class="prompt input_prompt">
   In [107]:
  </div>
  <div class="inner_cell">
   <div class="input_area collapsed">
    <div class="collapse_expand_button fa fa-1x fa-minus-square-o">
    </div>
    <div class="highlight hl-ipython3">
     <pre><span></span><span class="c1"># Use scope to add sub-values</span>
<span class="k">with</span> <span class="n">sf</span><span class="o">.</span><span class="n">scope</span><span class="p">(</span><span class="s2">"foo"</span><span class="p">):</span>
    <span class="n">inputs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">sf</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="s2">"x"</span><span class="p">))</span>
    <span class="k">with</span> <span class="n">sf</span><span class="o">.</span><span class="n">scope</span><span class="p">(</span><span class="s2">"bar"</span><span class="p">):</span>
        <span class="n">inputs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">sf</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="s2">"x"</span><span class="p">))</span>
        <span class="n">inputs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">sf</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="s2">"y"</span><span class="p">))</span>
<span class="n">inputs</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">foo</span><span class="o">.</span><span class="n">bar</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="s2">"z"</span><span class="p">)</span>
<span class="c1"># This attr can also be used to add new values</span>
<span class="n">inputs</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">foo</span><span class="o">.</span><span class="n">bar</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">1024</span>

<span class="k">with</span> <span class="n">inputs</span><span class="o">.</span><span class="n">scope</span><span class="p">(</span><span class="s2">"foo2"</span><span class="p">):</span>
    <span class="n">inputs</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="s2">"x"</span><span class="p">)</span>
<span class="k">with</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">"foo2"</span><span class="p">]</span><span class="o">.</span><span class="n">scope</span><span class="p">(</span><span class="s2">"bar2"</span><span class="p">):</span>
    <span class="n">inputs</span><span class="p">[</span><span class="s2">"foo2"</span><span class="p">][</span><span class="s2">"x"</span><span class="p">]</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="s2">"x"</span><span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">inputs</span><span class="o">.</span><span class="n">items_recursive</span><span class="p">())</span>
<span class="c1">#</span>
</pre>
    </div>
   </div>
  </div>
 </div>
 <div class="output_wrapper">
  <div class="output">
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_text output_subarea">
     <pre>Values(
  x: x,
  y: y,
  z: z,
  t:   Values(
    h: h,
    m: m,
    s: s,
    timezone:     Values(
      time_zone: zone,
    ),
  ),
  id: 1024,
  foo:   Values(
    x: foo.x,
    bar:     Values(
      x: 1024,
      y: foo.bar.y,
      z: z,
    ),
  ),
  foo2:   Values(
    x: foo2.x,
    bar2:     Values(
      x: bar2.x,
    ),
  ),
)</pre>
    </div>
   </div>
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_text output_subarea">
     <pre>[('x', x),
 ('y', y),
 ('z', z),
 ('t.h', h),
 ('t.m', m),
 ('t.s', s),
 ('t.timezone.time_zone', zone),
 ('id', 1024),
 ('foo.x', foo.x),
 ('foo.bar.x', 1024),
 ('foo.bar.y', foo.bar.y),
 ('foo.bar.z', z),
 ('foo2.x', foo2.x),
 ('foo2.bar2.x', bar2.x)]</pre>
    </div>
   </div>
  </div>
 </div>
</div>
<div class="cell border-box-sizing code_cell rendered">
 <div class="input">
  <div class="prompt input_prompt">
   In [118]:
  </div>
  <div class="inner_cell">
   <div class="input_area collapsed">
    <div class="collapse_expand_button fa fa-1x fa-minus-square-o">
    </div>
    <div class="highlight hl-ipython3">
     <pre><span></span><span class="c1"># Group Ops on values</span>
<span class="n">w_T_b</span> <span class="o">=</span> <span class="n">Values</span><span class="p">(</span>
    <span class="n">T</span><span class="o">=</span><span class="n">sf</span><span class="o">.</span><span class="n">Pose3</span><span class="o">.</span><span class="n">symbolic</span><span class="p">(</span><span class="s2">"T"</span><span class="p">)</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"tangent dim: </span><span class="si">{</span><span class="n">w_T_b</span><span class="o">.</span><span class="n">tangent_dim</span><span class="p">()</span><span class="si">}</span><span class="s2">, storage dim: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">w_T_b</span><span class="o">.</span><span class="n">to_storage</span><span class="p">())</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"storage_D_tangent shape: </span><span class="si">{</span><span class="n">w_T_b</span><span class="o">.</span><span class="n">storage_D_tangent</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="c1"># display(pose.to_tangent())</span>
<span class="n">p_w</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">Matrix</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">symbolic</span><span class="p">(</span><span class="s2">"w"</span><span class="p">)</span>
<span class="n">p_b</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">Matrix</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">symbolic</span><span class="p">(</span><span class="s2">"b"</span><span class="p">)</span>
<span class="n">residual</span> <span class="o">=</span> <span class="n">w_T_b</span><span class="p">[</span><span class="s2">"T"</span><span class="p">]</span> <span class="o">*</span> <span class="n">p_b</span> <span class="o">-</span> <span class="n">p_w</span>
<span class="n">residual_D_tangent</span> <span class="o">=</span> <span class="n">residual</span><span class="o">.</span><span class="n">jacobian</span><span class="p">(</span><span class="n">w_T_b</span><span class="p">[</span><span class="s2">"T"</span><span class="p">])</span>
<span class="n">display</span><span class="p">(</span><span class="n">residual</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">residual_D_tangent</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">residual_D_tangent</span><span class="p">)</span>
<span class="c1">#</span>
</pre>
    </div>
   </div>
  </div>
 </div>
 <div class="output_wrapper">
  <div class="output">
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_subarea output_stream output_stdout output_text">
     <pre>tangent dim: 6, storage dim: 7
storage_D_tangent shape: (7, 6)
</pre>
    </div>
   </div>
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_latex output_subarea">
     $\displaystyle \left[\begin{matrix}T.t0 + b_{0} \left(- 2 T.R_{y}^{2} - 2 T.R_{z}^{2} + 1\right) + b_{1} \left(- 2 T.R_{w} T.R_{z} + 2 T.R_{x} T.R_{y}\right) + b_{2} \cdot \left(2 T.R_{w} T.R_{y} + 2 T.R_{x} T.R_{z}\right) - w_{0}\\T.t1 + b_{0} \cdot \left(2 T.R_{w} T.R_{z} + 2 T.R_{x} T.R_{y}\right) + b_{1} \left(- 2 T.R_{x}^{2} - 2 T.R_{z}^{2} + 1\right) + b_{2} \left(- 2 T.R_{w} T.R_{x} + 2 T.R_{y} T.R_{z}\right) - w_{1}\\T.t2 + b_{0} \left(- 2 T.R_{w} T.R_{y} + 2 T.R_{x} T.R_{z}\right) + b_{1} \cdot \left(2 T.R_{w} T.R_{x} + 2 T.R_{y} T.R_{z}\right) + b_{2} \left(- 2 T.R_{x}^{2} - 2 T.R_{y}^{2} + 1\right) - w_{2}\end{matrix}\right]$
    </div>
   </div>
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_latex output_subarea">
     $\displaystyle \left( 3, \  6\right)$
    </div>
   </div>
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_latex output_subarea">
     $\displaystyle \left[\begin{matrix}b_{1} \cdot \left(2 T.R_{w} T.R_{y} + 2 T.R_{x} T.R_{z}\right) + b_{2} \cdot \left(2 T.R_{w} T.R_{z} - 2 T.R_{x} T.R_{y}\right) &amp; b_{0} \left(- 2 T.R_{w} T.R_{y} - 2 T.R_{x} T.R_{z}\right) + b_{2} \left(T.R_{w}^{2} + T.R_{x}^{2} - T.R_{y}^{2} - T.R_{z}^{2}\right) &amp; b_{0} \left(- 2 T.R_{w} T.R_{z} + 2 T.R_{x} T.R_{y}\right) + b_{1} \left(- T.R_{w}^{2} - T.R_{x}^{2} + T.R_{y}^{2} + T.R_{z}^{2}\right) &amp; 1 &amp; 0 &amp; 0\\b_{1} \left(- 2 T.R_{w} T.R_{x} + 2 T.R_{y} T.R_{z}\right) + b_{2} \left(- T.R_{w}^{2} + T.R_{x}^{2} - T.R_{y}^{2} + T.R_{z}^{2}\right) &amp; b_{0} \cdot \left(2 T.R_{w} T.R_{x} - 2 T.R_{y} T.R_{z}\right) + b_{2} \cdot \left(2 T.R_{w} T.R_{z} + 2 T.R_{x} T.R_{y}\right) &amp; b_{0} \left(T.R_{w}^{2} - T.R_{x}^{2} + T.R_{y}^{2} - T.R_{z}^{2}\right) + b_{1} \left(- 2 T.R_{w} T.R_{z} - 2 T.R_{x} T.R_{y}\right) &amp; 0 &amp; 1 &amp; 0\\b_{1} \left(T.R_{w}^{2} - T.R_{x}^{2} - T.R_{y}^{2} + T.R_{z}^{2}\right) + b_{2} \left(- 2 T.R_{w} T.R_{x} - 2 T.R_{y} T.R_{z}\right) &amp; b_{0} \left(- T.R_{w}^{2} + T.R_{x}^{2} + T.R_{y}^{2} - T.R_{z}^{2}\right) + b_{2} \left(- 2 T.R_{w} T.R_{y} + 2 T.R_{x} T.R_{z}\right) &amp; b_{0} \cdot \left(2 T.R_{w} T.R_{x} + 2 T.R_{y} T.R_{z}\right) + b_{1} \cdot \left(2 T.R_{w} T.R_{y} - 2 T.R_{x} T.R_{z}\right) &amp; 0 &amp; 0 &amp; 1\end{matrix}\right]$
    </div>
   </div>
  </div>
 </div>
</div>
<div class="cell border-box-sizing text_cell rendered">
 <div class="prompt input_prompt">
 </div>
 <div class="inner_cell">
  <div class="text_cell_render border-box-sizing rendered_html">
   <h3 id="Ops-Package">
    Ops Package
    <a class="anchor-link" href="#Ops-Package">
     ¶
    </a>
   </h3>
  </div>
 </div>
</div>
<div class="cell border-box-sizing text_cell rendered">
 <div class="prompt input_prompt">
 </div>
 <div class="inner_cell">
  <div class="text_cell_render border-box-sizing rendered_html">
   <h4 id="Storage-Ops">
    Storage Ops
    <a class="anchor-link" href="#Storage-Ops">
     ¶
    </a>
   </h4>
   <p>
    Data type that can be serialized to and from a vector of scalar quantities.
    <code>
     .storage_dim()
    </code>
    ,
    <code>
     .to_storage()
    </code>
    ,
    <code>
     .from_storage()
    </code>
    ,
    <code>
     .symbolic()
    </code>
    ,
    <code>
     .evalf()
    </code>
    ,
    <code>
     .subs()
    </code>
    ,
    <code>
     .simplify()
    </code>
   </p>
  </div>
 </div>
</div>
<div class="cell border-box-sizing code_cell rendered">
 <div class="input">
  <div class="prompt input_prompt">
   In [156]:
  </div>
  <div class="inner_cell">
   <div class="input_area">
    <div class="collapse_expand_button fa fa-1x fa-minus-square-o">
    </div>
    <div class="highlight hl-ipython3">
     <pre><span></span><span class="c1"># Storage Ops</span>

<span class="kn">from</span> <span class="nn">symforce.ops</span> <span class="kn">import</span> <span class="n">StorageOps</span>

<span class="c1"># Element-wise operations on Values object with multiple types of elements</span>
<span class="n">values</span> <span class="o">=</span> <span class="n">Values</span><span class="p">(</span>
    <span class="n">pose</span><span class="o">=</span><span class="n">sf</span><span class="o">.</span><span class="n">Pose3</span><span class="p">(),</span>
    <span class="n">scalar</span><span class="o">=</span><span class="n">sf</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="s2">"x"</span><span class="p">),</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Storage dim: </span><span class="si">{</span><span class="n">StorageOps</span><span class="o">.</span><span class="n">storage_dim</span><span class="p">(</span><span class="n">values</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>  <span class="c1"># 4 quaternion + 3 position + 1 scalar</span>

<span class="c1"># Serialize geometric type and reconstruct</span>
<span class="n">T</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">Pose3</span><span class="o">.</span><span class="n">symbolic</span><span class="p">(</span><span class="s2">"T"</span><span class="p">)</span>
<span class="n">T_serialized</span> <span class="o">=</span> <span class="n">StorageOps</span><span class="o">.</span><span class="n">to_storage</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
<span class="n">T_recovered</span> <span class="o">=</span> <span class="n">StorageOps</span><span class="o">.</span><span class="n">from_storage</span><span class="p">(</span><span class="n">sf</span><span class="o">.</span><span class="n">Pose3</span><span class="p">,</span> <span class="n">T_serialized</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">T_serialized</span><span class="p">)</span>
<span class="k">assert</span><span class="p">(</span><span class="n">T</span> <span class="o">==</span> <span class="n">T_recovered</span><span class="p">)</span>
</pre>
    </div>
   </div>
  </div>
 </div>
 <div class="output_wrapper">
  <div class="output">
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_subarea output_stream output_stdout output_text">
     <pre>Storage dim: 8
</pre>
    </div>
   </div>
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_latex output_subarea">
     $\displaystyle \left[ T.R_{x}, \  T.R_{y}, \  T.R_{z}, \  T.R_{w}, \  T.t0, \  T.t1, \  T.t2\right]$
    </div>
   </div>
  </div>
 </div>
</div>
<div class="cell border-box-sizing text_cell rendered">
 <div class="prompt input_prompt">
 </div>
 <div class="inner_cell">
  <div class="text_cell_render border-box-sizing rendered_html">
   <h4 id="Group-Ops">
    Group Ops
    <a class="anchor-link" href="#Group-Ops">
     ¶
    </a>
   </h4>
   <p>
    Mathematical group that implements closure, associativity, identity and invertibility.
Methods:
    <code>
     .identity()
    </code>
    ,
    <code>
     .inverse()
    </code>
    ,
    <code>
     .compose()
    </code>
    ,
    <code>
     .between()
    </code>
   </p>
  </div>
 </div>
</div>
<div class="cell border-box-sizing code_cell rendered">
 <div class="input">
  <div class="prompt input_prompt">
   In [157]:
  </div>
  <div class="inner_cell">
   <div class="input_area">
    <div class="collapse_expand_button fa fa-1x fa-minus-square-o">
    </div>
    <div class="highlight hl-ipython3">
     <pre><span></span><span class="c1"># Group Ops</span>
<span class="kn">from</span> <span class="nn">symforce.ops</span> <span class="kn">import</span> <span class="n">GroupOps</span>
<span class="c1"># Identity of a pose</span>
<span class="n">w_T_b</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">Pose3</span><span class="p">()</span>
<span class="n">display</span><span class="p">(</span><span class="n">GroupOps</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="n">w_T_b</span><span class="p">))</span>
<span class="c1"># Inverse of a vector</span>
<span class="n">p_b</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">V3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">GroupOps</span><span class="o">.</span><span class="n">inverse</span><span class="p">(</span><span class="n">p_b</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

<span class="c1"># Compose a pose and a point (wrong, they are not the same group)</span>
<span class="n">p_w</span> <span class="o">=</span> <span class="n">w_T_b</span> <span class="o">*</span> <span class="n">p_b</span> <span class="c1"># GroupOps.compose(w_T_b, p_b)</span>
<span class="c1"># display(p_w)</span>
<span class="n">display</span><span class="p">(</span><span class="n">GroupOps</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="n">p_b</span><span class="p">,</span> <span class="n">GroupOps</span><span class="o">.</span><span class="n">inverse</span><span class="p">(</span><span class="n">p_b</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</pre>
    </div>
   </div>
  </div>
 </div>
 <div class="output_wrapper">
  <div class="output">
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_text output_subarea">
     <pre>&lt;Pose3 R=&lt;Rot3 &lt;Q xyzw=[0, 0, 0, 1]&gt;&gt;, t=(0, 0, 0)&gt;</pre>
    </div>
   </div>
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_latex output_subarea">
     $\displaystyle \left[\begin{matrix}-1 &amp; -1 &amp; -1\end{matrix}\right]$
    </div>
   </div>
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_latex output_subarea">
     $\displaystyle \left[\begin{matrix}0 &amp; 0 &amp; 0\end{matrix}\right]$
    </div>
   </div>
  </div>
 </div>
</div>
<div class="cell border-box-sizing code_cell rendered">
 <div class="input">
  <div class="prompt input_prompt">
   In [174]:
  </div>
  <div class="inner_cell">
   <div class="input_area">
    <div class="collapse_expand_button fa fa-1x fa-minus-square-o">
    </div>
    <div class="highlight hl-ipython3">
     <pre><span></span><span class="c1"># Relative rotation -&gt; b1_R_b2 = GroupOps.between(w_R_b1, w_R_b2)</span>
<span class="n">w_R_b1</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">Rot3</span><span class="o">.</span><span class="n">from_angle_axis</span><span class="p">(</span>
    <span class="n">angle</span><span class="o">=</span><span class="n">sf</span><span class="o">.</span><span class="n">Scalar</span><span class="p">(</span><span class="mf">0.2</span><span class="p">),</span>
    <span class="n">axis</span><span class="o">=</span><span class="n">sf</span><span class="o">.</span><span class="n">V3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">normalized</span><span class="p">(),</span>
<span class="p">)</span>
<span class="n">w_R_b2</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">Rot3</span><span class="o">.</span><span class="n">from_angle_axis</span><span class="p">(</span>
    <span class="n">angle</span><span class="o">=</span><span class="n">sf</span><span class="o">.</span><span class="n">Scalar</span><span class="p">(</span><span class="mf">0.1</span><span class="p">),</span>
    <span class="n">axis</span><span class="o">=</span><span class="n">sf</span><span class="o">.</span><span class="n">V3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">normalized</span><span class="p">(),</span>
<span class="p">)</span>
<span class="n">b1_R_b2</span> <span class="o">=</span> <span class="n">GroupOps</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="n">w_R_b1</span><span class="p">,</span> <span class="n">w_R_b2</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">w_R_b2</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">GroupOps</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">GroupOps</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="n">w_R_b1</span><span class="p">,</span> <span class="n">b1_R_b2</span><span class="p">)))</span>
</pre>
    </div>
   </div>
  </div>
 </div>
 <div class="output_wrapper">
  <div class="output">
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_text output_subarea">
     <pre>&lt;Rot3 &lt;Q xyzw=[0.00499791692706783*sqrt(10), 0, 0.0149937507812035*sqrt(10), 0.998750260394966]&gt;&gt;</pre>
    </div>
   </div>
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_text output_subarea">
     <pre>&lt;Rot3 &lt;Q xyzw=[0.00499791692706783*sqrt(10), 0, 0.0149937507812035*sqrt(10), 0.998750260394966]&gt;&gt;</pre>
    </div>
   </div>
  </div>
 </div>
</div>
<div class="cell border-box-sizing text_cell rendered">
 <div class="prompt input_prompt">
 </div>
 <div class="inner_cell">
  <div class="text_cell_render border-box-sizing rendered_html">
   <h4 id="Lie-Group-Ops">
    Lie Group Ops
    <a class="anchor-link" href="#Lie-Group-Ops">
     ¶
    </a>
   </h4>
   <p>
    Group that is also a differentiable manifold, e.g. SO3, SE3.
Methods:
    <code>
     .tangent_dim()
    </code>
    ,
    <code>
     .from_tangent()
    </code>
    ,
    <code>
     to_tangent()
    </code>
    ,
    <code>
     .retract()
    </code>
    ,
    <code>
     .local_coordinates()
    </code>
    ,
    <code>
     .storage_D_tangent()
    </code>
   </p>
  </div>
 </div>
</div>
<div class="cell border-box-sizing code_cell rendered">
 <div class="input">
  <div class="prompt input_prompt">
   In [220]:
  </div>
  <div class="inner_cell">
   <div class="input_area">
    <div class="collapse_expand_button fa fa-1x fa-minus-square-o">
    </div>
    <div class="highlight hl-ipython3">
     <pre><span></span><span class="c1"># Lie Group Ops: basics</span>
<span class="kn">from</span> <span class="nn">symforce.ops</span> <span class="kn">import</span> <span class="n">LieGroupOps</span>
<span class="n">R</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">Rot3</span><span class="o">.</span><span class="n">symbolic</span><span class="p">(</span><span class="s1">'theta'</span><span class="p">)</span>
<span class="c1"># Underlying dimension of a 3D rotation's tangent space</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"3D rotation tangent space: </span><span class="si">{</span><span class="n">LieGroupOps</span><span class="o">.</span><span class="n">tangent_dim</span><span class="p">(</span><span class="n">R</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="n">R_tangent</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">V3</span><span class="p">(</span><span class="n">LieGroupOps</span><span class="o">.</span><span class="n">to_tangent</span><span class="p">(</span><span class="n">R</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">R_tangent</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">R_reconstruct_</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">Rot3</span><span class="o">.</span><span class="n">from_angle_axis</span><span class="p">(</span><span class="n">R_tangent</span><span class="o">.</span><span class="n">norm</span><span class="p">(),</span> <span class="n">R_tangent</span><span class="o">.</span><span class="n">normalized</span><span class="p">())</span>
<span class="n">R_reconstruct</span> <span class="o">=</span> <span class="n">LieGroupOps</span><span class="o">.</span><span class="n">from_tangent</span><span class="p">(</span><span class="n">sf</span><span class="o">.</span><span class="n">Rot3</span><span class="p">,</span> <span class="n">R_tangent</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">R_reconstruct_</span> <span class="o">==</span> <span class="n">R_reconstruct</span>
</pre>
    </div>
   </div>
  </div>
 </div>
 <div class="output_wrapper">
  <div class="output">
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_subarea output_stream output_stdout output_text">
     <pre>3D rotation tangent space: 3
</pre>
    </div>
   </div>
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_latex output_subarea">
     $\displaystyle \left[\begin{matrix}\frac{2 \theta_{x} \left(2 \min\left(0, \operatorname{sign}{\left(\theta_{w} \right)}\right) + 1\right) \operatorname{acos}{\left(\min\left(1.0, \left|{\theta_{w}}\right|\right) \right)}}{\sqrt{1 - \min\left(1.0, \left|{\theta_{w}}\right|\right)^{2}}} &amp; \frac{2 \theta_{y} \left(2 \min\left(0, \operatorname{sign}{\left(\theta_{w} \right)}\right) + 1\right) \operatorname{acos}{\left(\min\left(1.0, \left|{\theta_{w}}\right|\right) \right)}}{\sqrt{1 - \min\left(1.0, \left|{\theta_{w}}\right|\right)^{2}}} &amp; \frac{2 \theta_{z} \left(2 \min\left(0, \operatorname{sign}{\left(\theta_{w} \right)}\right) + 1\right) \operatorname{acos}{\left(\min\left(1.0, \left|{\theta_{w}}\right|\right) \right)}}{\sqrt{1 - \min\left(1.0, \left|{\theta_{w}}\right|\right)^{2}}}\end{matrix}\right]$
    </div>
   </div>
  </div>
 </div>
</div>
<div class="cell border-box-sizing code_cell rendered">
 <div class="input">
  <div class="prompt input_prompt">
   In [219]:
  </div>
  <div class="inner_cell">
   <div class="input_area">
    <div class="collapse_expand_button fa fa-1x fa-minus-square-o">
    </div>
    <div class="highlight hl-ipython3">
     <pre><span></span><span class="c1"># Lie Group Ops, retract: R_perturbed = R * delta_R, local_coordinates: delta_R = R.inv() * R_perturbed</span>

<span class="c1"># Retract perturbs the given element in the tangent space and returns the updated element</span>
<span class="n">R</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">Rot3</span><span class="o">.</span><span class="n">from_yaw_pitch_roll</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">R_tangent_delta</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">V3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
<span class="n">R_perturbed</span> <span class="o">=</span> <span class="n">LieGroupOps</span><span class="o">.</span><span class="n">retract</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">R_tangent_delta</span><span class="p">)</span>
<span class="c1"># Local coordinates compute the tangent space perturbation between one element and another</span>
<span class="n">R_tangent_delta_reconstruct</span> <span class="o">=</span> <span class="n">LieGroupOps</span><span class="o">.</span><span class="n">local_coordinates</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">R_perturbed</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">R_tangent_delta</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">R_tangent_delta_reconstruct</span><span class="p">)</span>
</pre>
    </div>
   </div>
  </div>
 </div>
 <div class="output_wrapper">
  <div class="output">
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_latex output_subarea">
     $\displaystyle \left[\begin{matrix}0 &amp; 0 &amp; 0.1\end{matrix}\right]$
    </div>
   </div>
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_latex output_subarea">
     $\displaystyle \left[ -1.1106857525106 \cdot 10^{-16}, \  0, \  0.1\right]$
    </div>
   </div>
  </div>
 </div>
</div>
<div class="cell border-box-sizing text_cell rendered">
 <div class="prompt input_prompt">
 </div>
 <div class="inner_cell">
  <div class="text_cell_render border-box-sizing rendered_html">
   <h3 id="Geo-Package-Ops-Operations">
    Geo Package Ops Operations
    <a class="anchor-link" href="#Geo-Package-Ops-Operations">
     ¶
    </a>
   </h3>
  </div>
 </div>
</div>
<div class="cell border-box-sizing text_cell rendered">
 <div class="prompt input_prompt">
 </div>
 <div class="inner_cell">
  <div class="text_cell_render border-box-sizing rendered_html">
   <h4 id="Geo-Storage-Operations">
    Geo Storage Operations
    <a class="anchor-link" href="#Geo-Storage-Operations">
     ¶
    </a>
   </h4>
  </div>
 </div>
</div>
<div class="cell border-box-sizing code_cell rendered">
 <div class="input">
  <div class="prompt input_prompt">
   In [228]:
  </div>
  <div class="inner_cell">
   <div class="input_area collapsed">
    <div class="collapse_expand_button fa fa-1x fa-minus-square-o">
    </div>
    <div class="highlight hl-ipython3">
     <pre><span></span><span class="c1"># Geo Storage Operations</span>
<span class="n">rot</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">Rot3</span><span class="p">()</span>
<span class="n">elements</span> <span class="o">=</span> <span class="n">rot</span><span class="o">.</span><span class="n">to_storage</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Symbolic to_storage test:"</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span> <span class="o">==</span> <span class="n">rot</span><span class="o">.</span><span class="n">storage_dim</span><span class="p">()</span>
<span class="n">display</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span>
<span class="c1"># Construction from scalar list</span>
<span class="n">rot2</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">Rot3</span><span class="o">.</span><span class="n">from_storage</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">rot</span> <span class="o">==</span> <span class="n">rot2</span>
<span class="c1"># Symbolic operations</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Symbolic subs test:"</span><span class="p">)</span>
<span class="n">rot_sym</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">Rot3</span><span class="o">.</span><span class="n">symbolic</span><span class="p">(</span><span class="s2">"rot_sym"</span><span class="p">)</span>
<span class="n">rot_num</span> <span class="o">=</span> <span class="n">rot_sym</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">rot_sym</span><span class="p">,</span> <span class="n">rot</span><span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="n">rot_sym</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">rot_num</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">rot_num</span><span class="o">.</span><span class="n">simplify</span><span class="p">())</span>  <span class="c1"># Simplify internal symbolic expressions</span>
<span class="n">display</span><span class="p">(</span><span class="n">rot_num</span><span class="o">.</span><span class="n">evalf</span><span class="p">())</span>  <span class="c1"># Numerical evaluation</span>
<span class="c1">#</span>
</pre>
    </div>
   </div>
  </div>
 </div>
 <div class="output_wrapper">
  <div class="output">
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_subarea output_stream output_stdout output_text">
     <pre>Symbolic to_storage test:
</pre>
    </div>
   </div>
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_latex output_subarea">
     $\displaystyle \left[ 0, \  0, \  0, \  1\right]$
    </div>
   </div>
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_subarea output_stream output_stdout output_text">
     <pre>Symbolic subs test:
</pre>
    </div>
   </div>
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_text output_subarea">
     <pre>&lt;Rot3 &lt;Q xyzw=[rot_sym_x, rot_sym_y, rot_sym_z, rot_sym_w]&gt;&gt;</pre>
    </div>
   </div>
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_text output_subarea">
     <pre>&lt;Rot3 &lt;Q xyzw=[0, 0, 0, 1]&gt;&gt;</pre>
    </div>
   </div>
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_text output_subarea">
     <pre>&lt;Rot3 &lt;Q xyzw=[0, 0, 0, 1]&gt;&gt;</pre>
    </div>
   </div>
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_text output_subarea">
     <pre>&lt;Rot3 &lt;Q xyzw=[0, 0, 0, 1.00000000000000]&gt;&gt;</pre>
    </div>
   </div>
  </div>
 </div>
</div>
<div class="cell border-box-sizing text_cell rendered">
 <div class="prompt input_prompt">
 </div>
 <div class="inner_cell">
  <div class="text_cell_render border-box-sizing rendered_html">
   <h4 id="Geo-Group-Operations">
    Geo Group Operations
    <a class="anchor-link" href="#Geo-Group-Operations">
     ¶
    </a>
   </h4>
  </div>
 </div>
</div>
<div class="cell border-box-sizing code_cell rendered">
 <div class="input">
  <div class="prompt input_prompt">
   In [226]:
  </div>
  <div class="inner_cell">
   <div class="input_area collapsed">
    <div class="collapse_expand_button fa fa-1x fa-minus-square-o">
    </div>
    <div class="highlight hl-ipython3">
     <pre><span></span><span class="c1"># Geo Group Operations</span>
<span class="n">R1</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">Rot3</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
<span class="n">R2</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">Rot3</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>

<span class="c1"># Composition</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Composition test:"</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">R1</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="n">R2</span><span class="p">))</span>  <span class="c1"># For rotations this is the same as R1 * R2</span>
<span class="c1"># Identity</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Identity test:"</span><span class="p">)</span>
<span class="n">R_identity</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">Rot3</span><span class="o">.</span><span class="n">identity</span><span class="p">()</span>
<span class="n">display</span><span class="p">(</span><span class="n">R1</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">R_identity</span> <span class="o">*</span> <span class="n">R1</span><span class="p">)</span>
<span class="c1"># Inverse</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Inverse test:"</span><span class="p">)</span>
<span class="n">R1_inv</span> <span class="o">=</span> <span class="n">R1</span><span class="o">.</span><span class="n">inverse</span><span class="p">()</span>
<span class="n">display</span><span class="p">(</span><span class="n">R_identity</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">R1_inv</span> <span class="o">*</span> <span class="n">R1</span><span class="p">)</span>
<span class="c1"># Between</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Between test:"</span><span class="p">)</span>
<span class="n">R_delta</span> <span class="o">=</span> <span class="n">R1</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="n">R2</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">R1</span> <span class="o">*</span> <span class="n">R_delta</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">R2</span><span class="p">)</span>
<span class="c1">#</span>
</pre>
    </div>
   </div>
  </div>
 </div>
 <div class="output_wrapper">
  <div class="output">
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_subarea output_stream output_stdout output_text">
     <pre>Composition test:
</pre>
    </div>
   </div>
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_text output_subarea">
     <pre>&lt;Rot3 &lt;Q xyzw=[0.653650322359889, -0.691680810177783, -0.212217870334203, -0.221996595517666]&gt;&gt;</pre>
    </div>
   </div>
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_subarea output_stream output_stdout output_text">
     <pre>Identity test:
</pre>
    </div>
   </div>
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_text output_subarea">
     <pre>&lt;Rot3 &lt;Q xyzw=[-0.791212654348329, -0.357369165559331, -0.282587404337844, 0.407938934175323]&gt;&gt;</pre>
    </div>
   </div>
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_text output_subarea">
     <pre>&lt;Rot3 &lt;Q xyzw=[-0.791212654348329, -0.357369165559331, -0.282587404337844, 0.407938934175323]&gt;&gt;</pre>
    </div>
   </div>
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_subarea output_stream output_stdout output_text">
     <pre>Inverse test:
</pre>
    </div>
   </div>
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_text output_subarea">
     <pre>&lt;Rot3 &lt;Q xyzw=[0, 0, 0, 1]&gt;&gt;</pre>
    </div>
   </div>
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_text output_subarea">
     <pre>&lt;Rot3 &lt;Q xyzw=[0, 0, 0, 1.00000000000000]&gt;&gt;</pre>
    </div>
   </div>
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_subarea output_stream output_stdout output_text">
     <pre>Between test:
</pre>
    </div>
   </div>
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_text output_subarea">
     <pre>&lt;Rot3 &lt;Q xyzw=[0.210623061771348, -0.00887545816305885, -0.930166453588175, -0.300581970037551]&gt;&gt;</pre>
    </div>
   </div>
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_text output_subarea">
     <pre>&lt;Rot3 &lt;Q xyzw=[0.210623061771348, -0.00887545816305891, -0.930166453588175, -0.300581970037551]&gt;&gt;</pre>
    </div>
   </div>
  </div>
 </div>
</div>
<div class="cell border-box-sizing text_cell rendered">
 <div class="prompt input_prompt">
 </div>
 <div class="inner_cell">
  <div class="text_cell_render border-box-sizing rendered_html">
   <h4 id="Geo-Tangent-Operations">
    Geo Tangent Operations
    <a class="anchor-link" href="#Geo-Tangent-Operations">
     ¶
    </a>
   </h4>
  </div>
 </div>
</div>
<div class="cell border-box-sizing code_cell rendered">
 <div class="input">
  <div class="prompt input_prompt">
   In [233]:
  </div>
  <div class="inner_cell">
   <div class="input_area collapsed">
    <div class="collapse_expand_button fa fa-1x fa-minus-square-o">
    </div>
    <div class="highlight hl-ipython3">
     <pre><span></span><span class="c1"># Geo Tangent Operations</span>
<span class="c1"># To/From tangent space vector about identity element</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"To/From tangent space vector test:"</span><span class="p">)</span>
<span class="n">R1</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">Rot3</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
<span class="n">tangent_vec</span> <span class="o">=</span> <span class="n">R1</span><span class="o">.</span><span class="n">to_tangent</span><span class="p">()</span>
<span class="n">R1_recovered</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">Rot3</span><span class="o">.</span><span class="n">from_tangent</span><span class="p">(</span><span class="n">tangent_vec</span><span class="p">)</span>

<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">tangent_vec</span><span class="p">)</span> <span class="o">==</span> <span class="n">R1</span><span class="o">.</span><span class="n">tangent_dim</span><span class="p">()</span>
<span class="n">display</span><span class="p">(</span><span class="n">R1</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">R1_recovered</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"Tangent space perturbations test:"</span><span class="p">)</span>
<span class="c1"># Tangent space perturbations</span>
<span class="c1"># Perturb R1 by the given vector in the tangent space around R1</span>
<span class="n">R_perturb_delta</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">2.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">]</span>
<span class="n">R2</span> <span class="o">=</span> <span class="n">R1</span><span class="o">.</span><span class="n">retract</span><span class="p">(</span><span class="n">R_perturb_delta</span><span class="p">)</span>

<span class="c1"># Compute the tangent vector pointing from R1 to R2, in the tangent space around R1</span>
<span class="n">recovered_tangent_vec</span> <span class="o">=</span> <span class="n">R1</span><span class="o">.</span><span class="n">local_coordinates</span><span class="p">(</span><span class="n">R2</span><span class="p">)</span>
<span class="n">recovered_tangent_vec2</span> <span class="o">=</span> <span class="n">R1</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="n">R2</span><span class="p">)</span><span class="o">.</span><span class="n">to_tangent</span><span class="p">()</span>
<span class="n">display</span><span class="p">(</span><span class="n">R_perturb_delta</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">recovered_tangent_vec</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">recovered_tangent_vec2</span><span class="p">)</span>

<span class="n">jacobian</span> <span class="o">=</span> <span class="n">R1</span><span class="o">.</span><span class="n">storage_D_tangent</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">jacobian</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">R1</span><span class="o">.</span><span class="n">storage_dim</span><span class="p">(),</span> <span class="n">R1</span><span class="o">.</span><span class="n">tangent_dim</span><span class="p">())</span>
<span class="c1">#</span>
</pre>
    </div>
   </div>
  </div>
 </div>
 <div class="output_wrapper">
  <div class="output">
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_subarea output_stream output_stdout output_text">
     <pre>To/From tangent space vector test:
</pre>
    </div>
   </div>
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_text output_subarea">
     <pre>&lt;Rot3 &lt;Q xyzw=[0.205544235406664, -0.0361582276632704, -0.977639522350119, -0.0257898081104291]&gt;&gt;</pre>
    </div>
   </div>
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_text output_subarea">
     <pre>&lt;Rot3 &lt;Q xyzw=[-0.205544235406664, 0.0361582276632704, 0.977639522350119, 0.0257898081104292]&gt;&gt;</pre>
    </div>
   </div>
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_subarea output_stream output_stdout output_text">
     <pre>Tangent space perturbations test:
</pre>
    </div>
   </div>
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_latex output_subarea">
     $\displaystyle \left[ 0.1, \  2.3, \  -0.5\right]$
    </div>
   </div>
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_latex output_subarea">
     $\displaystyle \left[ 0.1, \  2.3, \  -0.5\right]$
    </div>
   </div>
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_latex output_subarea">
     $\displaystyle \left[ 0.1, \  2.3, \  -0.5\right]$
    </div>
   </div>
  </div>
 </div>
</div>
<div class="cell border-box-sizing text_cell rendered">
 <div class="prompt input_prompt">
 </div>
 <div class="inner_cell">
  <div class="text_cell_render border-box-sizing rendered_html">
   <h4 id="Special-SE(n)">
    Special SE(n)
    <a class="anchor-link" href="#Special-SE(n)">
     ¶
    </a>
   </h4>
   <p>
    Perturbation on SE(3) is done separately on SO(3) and R(3).
   </p>
   <pre><code>Pose3(R=self.R.retract(vec[:3], epsilon=epsilon),
t=ops.LieGroupOps.retract(self.t, vec[3:], epsilon=epsilon))
</code></pre>
  </div>
 </div>
</div>
<div class="cell border-box-sizing code_cell rendered">
 <div class="input">
  <div class="prompt input_prompt">
   In [259]:
  </div>
  <div class="inner_cell">
   <div class="input_area">
    <div class="collapse_expand_button fa fa-1x fa-minus-square-o">
    </div>
    <div class="highlight hl-ipython3">
     <pre><span></span><span class="c1"># SE(n)</span>
<span class="n">T</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">Pose3</span><span class="p">(</span><span class="n">sf</span><span class="o">.</span><span class="n">Rot3</span><span class="o">.</span><span class="n">random</span><span class="p">(),</span> <span class="n">sf</span><span class="o">.</span><span class="n">V3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
<span class="n">T_tangent_delta</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span>
<span class="n">T_perturb</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">retract</span><span class="p">(</span><span class="n">T_tangent_delta</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">T_perturb</span><span class="p">)</span>
<span class="n">T_perturb_reconstruct</span> <span class="o">=</span>  <span class="n">T</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="n">sf</span><span class="o">.</span><span class="n">Pose3</span><span class="o">.</span><span class="n">from_tangent</span><span class="p">(</span><span class="n">T_tangent_delta</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">T_perturb_reconstruct</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">T_perturb_reconstruct</span> <span class="o">!=</span> <span class="n">T_perturb</span> <span class="c1"># This is expected since SE(3) is modeled as SO(3) + R(3)</span>
<span class="n">T_perturb_reconstruct</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">Pose3</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">rotation</span><span class="p">()</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="n">sf</span><span class="o">.</span><span class="n">Rot3</span><span class="o">.</span><span class="n">from_tangent</span><span class="p">(</span><span class="n">T_tangent_delta</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">])),</span> 
                                             <span class="n">T</span><span class="o">.</span><span class="n">t</span> <span class="o">+</span> <span class="n">sf</span><span class="o">.</span><span class="n">V3</span><span class="p">(</span><span class="n">T_tangent_delta</span><span class="p">[</span><span class="mi">3</span><span class="p">:]))</span>
<span class="k">assert</span> <span class="n">T_perturb_reconstruct</span> <span class="o">==</span> <span class="n">T_perturb</span>
<span class="n">display</span><span class="p">(</span><span class="n">T_perturb_reconstruct</span><span class="p">)</span>
</pre>
    </div>
   </div>
  </div>
 </div>
 <div class="output_wrapper">
  <div class="output">
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_text output_subarea">
     <pre>&lt;Pose3 R=&lt;Rot3 &lt;Q xyzw=[-0.786164569658020, -0.406853477120950, -0.308209471241873, -0.348457227512671]&gt;&gt;, t=(0, 0, 1)&gt;</pre>
    </div>
   </div>
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_text output_subarea">
     <pre>&lt;Pose3 R=&lt;Rot3 &lt;Q xyzw=[-0.805545422953996, -0.398861926943418, -0.343397355446605, -0.272183745042075]&gt;&gt;, t=(0.100000000000000, 0, 1.10000000000000)&gt;</pre>
    </div>
   </div>
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_text output_subarea">
     <pre>&lt;Pose3 R=&lt;Rot3 &lt;Q xyzw=[-0.805545422953996, -0.398861926943418, -0.343397355446605, -0.272183745042075]&gt;&gt;, t=(0.124710314191249, 0.0557405950682781, 0.963389569850190)&gt;</pre>
    </div>
   </div>
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_text output_subarea">
     <pre>&lt;Pose3 R=&lt;Rot3 &lt;Q xyzw=[-0.805545422953996, -0.398861926943418, -0.343397355446605, -0.272183745042075]&gt;&gt;, t=(0.100000000000000, 0, 1.10000000000000)&gt;</pre>
    </div>
   </div>
  </div>
 </div>
</div>
<div class="cell border-box-sizing text_cell rendered">
 <div class="prompt input_prompt">
 </div>
 <div class="inner_cell">
  <div class="text_cell_render border-box-sizing rendered_html">
   <h2 id="Solve-Problems-in-Real-World">
    Solve Problems in Real World
    <a class="anchor-link" href="#Solve-Problems-in-Real-World">
     ¶
    </a>
   </h2>
  </div>
 </div>
</div>

<div> This blog is converted from <a href="https://github.com/xipengwang/xipengwang.github.io/tree/master/notebooks/symforce.ipynb">symforce.ipynb</a></div>